<main>
    <h1> Your Profile </h1>
    <br>
    <h3>Name</h3>
    <div id="nameContainer"></div>
    <h3>User Tickets</h3>
    <button id="refTickets" onclick="refreshTickets()">Refresh</button>
    <div id="ticketCont"></div>

    <script>
        window.onload = populateUsername;

        async function populateUsername() {
            var nameContainer = document.getElementById("nameContainer")
            const response = await fetch("/profile/getUsername", {
                method: 'POST', 
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({})
            });
            const username = await response.text();
            nameContainer.innerHTML = `<p> ${username} </p>`
        }

        async function refreshTickets() {
            const ticketContainer = document.getElementById("ticketCont");
            ticketContainer.innerHTML = "<p>Loading...</p>";
            const response = await fetch("/profile/userTickets", {
                method: 'POST', 
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({})
            });
            const tickets = await response.json()
            ticketContainer.innerHTML = "";
            tickets.forEach(ticket => {

                const div = document.createElement("div");
                div.innerHTML = `<p> Listing: ${ticket.listing_id}, Seat: ${ticket.seat_num}</p><br>\n<hr>`;

                ticketContainer.appendChild(div);
            });
        }
    </script>
</main>

<style>
    main {
        padding: 20px;
		max-width: 30vw;
        font-size: 20px;
		font-family: Arial, sans-serif;
    }
</style>