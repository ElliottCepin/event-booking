<main>
        <h1> Your Profile </h1>
    
    <br>
    <div id="userName">
    <h3>User Name:</h3>
    <div id="nameContainer"></div>
    <a href="login" target="_blank"><button onclick="signOut()">Sign Out</button></a>
    </div>
    
    <hr>
    <h3>User Tickets</h3>
    <div id="ticketCont"></div>
    <br>
    <button id="refTickets" onclick="refreshTickets()">Refresh</button>
    <script>
populateUsername();

async function populateUsername() {
    const nameContainer = document.getElementById("nameContainer");
    const response = await fetch("/profile/getUsername"); // GET instead of POST
    const username = await response.text();
    console.log("username:", username);
    nameContainer.innerHTML = `<p>${username}</p>`;
}

async function signOut() {
    await fetch("/profile/signOut");

}

async function refreshTickets() {
    const ticketContainer = document.getElementById("ticketCont");
    ticketContainer.innerHTML = "<p>Loading...</p>";

    const response = await fetch("/profile/userTickets"); // GET instead of POST
    if (!response.ok) {
        ticketContainer.innerHTML = "<p>Error loading tickets</p>";
        return;
    }

    const tickets = await response.json(); // parse JSON
    ticketContainer.innerHTML = "";

    if (tickets.length === 0) {
        ticketContainer.innerHTML = "<p>No tickets reserved yet</p>";
        return;
    }

    tickets.forEach(ticket => {
        const div = document.createElement("div");
        div.innerHTML = `<h4>${ticket.listingName}</h4>\n<p>Number of seats: ${ticket.seats}</p>\n<p>Time Slot: ${ticket.timeslot}</p><hr>`;
        ticketContainer.appendChild(div);
    });
}

</script>
</main>

<style>
    main {
        padding: 20px;
		max-width: 30vw;
        font-size: 20px;
		font-family: Arial, sans-serif;
    } 
    #username {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        min-width: 20vw;
    }
    #ticketCont {
        margin-left: 20px;
    }
</style>